# 第4章 接合モデル
簡単にテストできるプログラムを書くには、
- 開発と並行してテストを作成する　★重要
- 少し時間をかけて「テストの容易性に配慮した設計」を行う

## 接合部
単体テストのために個々のクラスを取り出そうそすると、たくさんの依存関係を排除する必要がある  
いくら設計が **優れていた**としても、しばしば多くの作業が発生してしまう  

```C++
bool CAnsyncSslRec::Init() {
    if (m_bSslInitialized) {
        return true;
    }

    m_smutex.Unlock();
    m_nSslRefCount++;

    m_bSslInitialized = true;

    FreeLibrary(m_hSslD111);
    m_hSs1D111 = 0;

    FreeLibrary(m_hSs1D112);
    m_hSs1D112 = 0;

    if (!m_bFailureSent) {
        m_bFailureSent = TRUE;
        
        // この行を実行したくない
        // 別のサブシステムとやりとりするグローバルな関数。
        // この関数を呼び出さずにInitメソッドを実行するには？？？？
        PostReceiveError(SOCKETCALLBACK, SSL_FAILURE);
    }

    CreateLibrary(m_hSs1D111, "syncese11.dll");
    CreateLibrary(m_hSs1D112, "syncese11.dll");

    m_hSs1D111->Init();
    m_hSs1D112->Init();

    return true;

}
```

PostReceiveError関数を呼び出さずにInitメソッドを実行するには？？ -> この考え方が接合部に繋がる  
**接合部**  
その場所を直接修正しなくても、プログラムの振る舞いを変えることのできる場所  

```C++
// PostReceiveError関数を呼び出さずにInitメソッドを実行するには？？
// 同じシグネチャを持つメソッドをこのクラスに追加する
class CAsyncSslRec {
    virtual void PostReceiveError(UINT type, UINT errorcode);
}
```